- hosts: all
  become: true
  tasks:

    - name: Disable SELinux (RedHat family)
      selinux:
        state: disabled
      when: ansible_os_family == "RedHat"

    - name: Check if firewalld exists
      command: systemctl status firewalld
      register: firewalld_status
      failed_when: false
      changed_when: false
      when: ansible_os_family == "RedHat"

    - name: Stop and disable firewalld if present
      service:
        name: firewalld
        state: stopped
        enabled: false
      when:
        - ansible_os_family == "RedHat"
        - firewalld_status.rc == 0
